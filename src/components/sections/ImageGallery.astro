---
import Container from "../shared/Container.astro";
---

<Container>
  <div class="text-center max-w-3xl mx-auto mb-12">
    <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">Glimpse of our recent events</h2>
    <p class="text-lg text-gray-600">Memorable moments from our journey across India</p>
  </div>

  <div id="tour-gallery" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 mt-10">
    <div class="gallery-loading text-center py-8 text-gray-500 col-span-full">Loading tour photos...</div>
  </div>

  <script is:inline>
    document.addEventListener('DOMContentLoaded', async () => {
      const galleryDiv = document.getElementById('tour-gallery');
      const loadingElement = galleryDiv.querySelector('.gallery-loading');
      const folderId = '1nd-wqJxn1j49OcuKaxBLpD1hpghYuqVh';
      const apiKey = 'AIzaSyBDJui9IsGMJrdgp-b46_eYHWuqHk0xqBk';
      
      try {
        loadingElement.textContent = 'Connecting to Google Drive...';
        
        const response = await fetch(`https://www.googleapis.com/drive/v3/files?q='${folderId}'+in+parents&key=${apiKey}`);
        
        if (!response.ok) {
          throw new Error(`API Error: ${response.status}`);
        }
        
        const data = await response.json();
        console.log('Google Drive API Response:', data); // Debugging
        
        if (!data.files || data.files.length === 0) {
          loadingElement.textContent = 'No photos found in the specified folder.';
          return;
        }
        
        loadingElement.remove();
        
        data.files.forEach(file => {
          if (file.mimeType.includes("image")) {
            const imgUrl = `https://drive.google.com/thumbnail?export=view&id=${file.id}&sz=w1000`;
            console.log('Loading image:', imgUrl); // Debugging
            
            const galleryItem = document.createElement('div');
            galleryItem.className = 'gallery-item relative group overflow-hidden rounded-lg shadow-md hover:shadow-lg transition-all duration-300 h-64';
            
            galleryItem.innerHTML = `
              <img 
                src="${imgUrl}" 
                alt="${file.name}" 
                loading="lazy"
                class="w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"
                onerror="this.onerror=null;this.parentElement.innerHTML='<div class=\'h-full flex items-center justify-center text-red-500\'>Failed to load image</div>'"
              >
              <div class="gallery-caption absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-60 flex flex-col justify-end p-4 transition-all duration-300 opacity-0 group-hover:opacity-100">
                <h3 class="text-white font-bold text-lg">${file.name.split(',')[0] || 'Our Event'}</h3>
                ${file.name.split(',').length > 1 ? `<h3 class="text-white font-medium">From ${file.name.split(',')[1]}</h3>` : ''}
                <p class="text-gray-200 text-sm mt-1">From our India Tour 2024</p>
              </div>
            `;
            
            galleryDiv.appendChild(galleryItem);
          }
        });
        
      } catch (error) {
        console.error('Gallery Error:', error);
        loadingElement.textContent = `Error loading photos: ${error.message}`;
        loadingElement.classList.add('text-red-500');
      }
    });
  </script>

  <style is:global>
    .gallery-item {
      min-height: 16rem;
    }
    .gallery-caption {
      transform: translateY(20px);
    }
    .gallery-item:hover .gallery-caption {
      transform: translateY(0);
    }
  </style>
</Container>